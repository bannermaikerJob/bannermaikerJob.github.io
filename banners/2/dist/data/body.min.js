/* Created by Olphabet */var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),mygame;!function(a){!function(a){a[a.DISABLED=0]="DISABLED",a[a.ACTIVE=1]="ACTIVE"}(a.BlockTypes||(a.BlockTypes={}));var b=function(b){function c(c,d,e,f){var g=b.call(this,c,d,e)||this;g._fieldUpperBound=[],g._followGem1=!1,g._followGem2=!1,g._followGem3=!1,g._background=g.game.add.sprite(-15,-15,"atlas2","field"),g._background.inputEnabled=!0,g._background.anchor.set(0,0),g.addChild(g._background),g._maxColorStreak=0,g._boomAnimation=!1,g._sequences=[],g._playState=f,g._tweenArray=[],g._tempSprite=[],g._destroyed=0,g._turnOffMask=!1,g._firstMatch=!1,g._finalWasFired=!1,g._gameArray=a.GameConfig.gameArray,g._fieldUpperBound=[1,0,0,0,0,0,1,0,0,0,0],g._streak=[];for(var h=0;h<6;h++)g._streak.push(0);return g._disabled=!1,g._bgContainer=g.game.add.sprite(0,0),g._bgContainer.anchor.set(.5,0),g.addChild(g._bgContainer),g._container=g.game.add.sprite(0,0),g._container.anchor.set(.5,0),g.addChild(g._container),g._myMask=g.game.add.graphics(0,0),g.addChild(g._myMask),g._container.mask=g._myMask,g._myMask.beginFill(16777215),g._myMask.drawRect(a.GameConfig.BLOCK_SIZE,0,5*a.GameConfig.BLOCK_SIZE,a.GameConfig.BLOCK_SIZE),g._myMask.drawRect(0,a.GameConfig.BLOCK_SIZE,7*a.GameConfig.BLOCK_SIZE,3*a.GameConfig.BLOCK_SIZE),g._myMask.drawRect(a.GameConfig.BLOCK_SIZE,4*a.GameConfig.BLOCK_SIZE,5*a.GameConfig.BLOCK_SIZE,a.GameConfig.BLOCK_SIZE),g._myMask.endFill(),g.drawField(),g._selectedGem=null,window.collectable,g._counter=0,g.game.input.onUp.add(function(){if(g.game.input.deleteMoveCallback(g.gemMove,g),null!==g._selectedGem&&void 0!==g._selectedGem&&g._selectedGem.isBomb&&null==g._pickedGem){g._removeMap=[];for(var a=0;a<g._gameArray.length;a++){g._removeMap[a]=[];for(var b=0;b<g._gameArray[a].length;b++)g._removeMap[a].push(0)}g.setOff(g._selectedGem.mytype-5),g.destroyGems()}},g),g._canClick=!0,window.particleOn,g.createLightning(),g.game.time.events.add(window.restartBlinkTime,g.blink,g),g._createBomb=!1,g._condensationPoint=new Phaser.Point(0,0),g}return __extends(c,b),c.prototype.createLightning=function(){this._lightnings=[];for(var a=[0,-90,90,180],b=this,c=0;c<4;c++)!function(c){var d=b.game.add.sprite(100,100,"atlas2","light_line_10001");d.anchor.set(0,.5),d.scale.x=5,d.alpha=0,d.animations.add("play",Phaser.Animation.generateFrameNames("light_line_",10001,10022),24).onComplete.add(function(){d.alpha=0},b),d.angle=a[c],b._container.addChild(d),b._lightnings.push(d)}(c)},Object.defineProperty(c.prototype,"firstMatchCallback",{set:function(a){this._firstMatchCallback=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"endMatchCallback",{set:function(a){this._endMatchCallback=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"disableField",{set:function(a){this._disabled=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"destroyCallback",{set:function(a){this._cb=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"finalCallback",{set:function(a){this._finalCallback=a},enumerable:!0,configurable:!0}),c.prototype.blink=function(){for(var a=this.game.rnd.between(1,5),b=[],c=0;c<this._gameArray.length;c++)for(var d=0;d<this._gameArray[c].length;d++)this._gameArray[c][d].mytype==a&&b.push(this._gameArray[c][d]);b.forEach(function(a){return a.playBlink()}),this.game.time.events.add(window.restartBlinkTime,this.blink,this)},c.prototype.gemMove=function(b,c,d){var e=c-this._selectedPoint.x,f=d-this._selectedPoint.y,g=0,h=0;if(Math.abs(e)>a.GameConfig.BLOCK_SIZE/2?h=e>0?1:-1:Math.abs(f)>a.GameConfig.BLOCK_SIZE/2&&(g=f>0?1:-1),g+h!=0){var i=this._selectedGem.row+g,j=this._selectedGem.col+h;i>=0&&i<this._gameArray.length&&j>=0&&j<this._gameArray[0].length?(this._pickedGem=this._gameArray[this._selectedGem.row+g][this._selectedGem.col+h],this._pickedGem.mytype>0?(this._selectedGem.deselect(),this.swapGems(!0),this.game.input.deleteMoveCallback(this.gemMove,this)):this._pickedGem=null):this._pickedGem=null}},c.prototype.drawField=function(){for(var b=this,c=0;c<this._gameArray.length;c++)for(var d=this,e=0;e<this._gameArray[c].length;e++)!function(e){var f=d._gameArray[c][e],g=a.GameConfig.BLOCK_SIZE*(e+.5),h=a.GameConfig.BLOCK_SIZE*(c+.5);if(f>0){var i=new a.Gem(d.game,g,h,f);d._container.addChild(i),i._sprite.inputEnabled=!0,i.row=c,i.col=e,i._sprite.events.onInputDown.add(function(a,c){var d;d=window.tutorial&&2==i.row&&2==i.mytype||!window.tutorial,d=d||window.tutorial&&3==i.col&&4==i.mytype,b._canClick&&d&&!b._disabled&&(null==b._selectedGem?(b._selectedGem=i,b._selectedPoint=new Phaser.Point(c.x,c.y),i.select(),b.game.input.addMoveCallback(b.gemMove,b)):b.gemSelect(i))},d),d._gameArray[c][e]=i}else d._gameArray[c][e]=new a.Gem(d.game,g,h,0),d._gameArray[c][e].row=c,d._gameArray[c][e].col=e}(e);window.tutorial&&(this._border=this.game.add.sprite(2.5*a.GameConfig.BLOCK_SIZE,2.5*a.GameConfig.BLOCK_SIZE,"atlas2","selection"),this._border.scale.set(.6,.6),this._border.anchor.set(.5),this._borderTween=this.game.add.tween(this._border.scale).to({x:.8,y:.8},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this._container.addChild(this._border))},c.prototype.endGame=function(){for(var a=this,b=0;b<this._gameArray.length;b++)for(var c=0;c<this._gameArray[b].length;c++)try{this._gameArray[b][c]._sprite.inputEnabled=!1}catch(a){continue}setTimeout(function(){a._finalCallback()},1e3)},c.prototype.clearTweens=function(){if(this._tweenArray.length>0)for(var a=0;a<this._tweenArray.length;a++)null!=this._tweenArray[a]&&this.game.tweens.remove(this._tweenArray[a]);if(this._tweenArray=[],this._tempSprite.length>0)for(var a=0;a<this._tempSprite.length;a++)null!=this._tempSprite[a]&&this._tempSprite[a].destroy(!0);this._tempSprite=[];for(var a=0;a<this._gameArray.length;a++)for(var b=0;b<this._gameArray[a].length;b++)null!=this._gameArray[a][b]&&this._gameArray[a][b].clearTweens()},c.prototype.replay=function(){this._disabled=!1,this._finalWasFired=!1,window.collectable,this._counter=0},c.prototype.gemSelect=function(a){if(null!=this._selectedGem)return this._selectedGem.isSame(a)?(this._selectedGem.deselect(),void(this._selectedGem=null)):void(this._selectedGem.isNext(a)?(this._selectedGem.deselect(),this._pickedGem=a,this.swapGems()):(this._selectedGem.deselect(),this._selectedGem=a,a.select()))},c.prototype.resetBoard=function(){for(var b=0;b<this._gameArray.length;b++)for(var c=0;c<this._gameArray[0].length;c++)this._gameArray[b][c].mytype>0&&(this._gameArray[b][c].mytype=a.GameConfig.gameArrayLandscape[b][c]);this._canClick=!0},c.prototype.moveExists=function(){for(var a="",b=6,c=0;c<this._gameArray.length;c++){for(var d=0;d<this._gameArray[c].length;d++)if(this._gameArray[c][d].mytype<0?a+="0":a+=this._gameArray[c][d].mytype,this._gameArray[c][d].mytype>5)return!0;a+=b,b++,b>9&&(b=6),a+="\n"}return null!=/(\d)(?:.|(?:.|\n){9}|(?:.|\n){6})?\1\1|(\d)\2(?:.|(?:.|\n){9}|(?:.|\n){6})?\2|(\d)(?:.|\n){7}\3(?:.|(?:.|\n){9})\3|(\d)(?:.|(?:.|\n){9})\4(?:.|\n){7}\4|(\d)(?:(?:.|\n){7,9}|(?:.|\n){17})\5(?:.|\n){8}\5|(\d)(?:.|\n){8}\6(?:(?:.|\n){7,9}|(?:.|\n){17})\6/.exec(a)},c.prototype.swapGems=function(b){var c=this;if(void 0===b&&(b=!0),window.tutorial){var d=Math.min(this._selectedGem.col,this._pickedGem.col),e=Math.max(this._selectedGem.col,this._pickedGem.col);if(1!=Math.abs(this._pickedGem.col-this._selectedGem.col)||2!=d&&3!=e)return this._selectedGem=null,void(this._pickedGem=null);window.tutorial=!1;for(var f=0;f<this._gameArray.length;f++)for(var g=0;g<this._gameArray[f].length;g++)this._playState.destroyTutorial(),this._borderTween.stop(),this._border.destroy()}this._canClick=!1,this._coolAnimation=!0,this._verticalAnimation=!1,this._gameArray[this._selectedGem.row][this._selectedGem.col]=this._pickedGem,this._gameArray[this._pickedGem.row][this._pickedGem.col]=this._selectedGem;var h=this._selectedGem.row,i=this._selectedGem.col,j=this._pickedGem.row,k=this._pickedGem.col;this._selectedGem.row=j,this._selectedGem.col=k,this._pickedGem.row=h,this._pickedGem.col=i;var l=new Phaser.Point((k+.5)*a.GameConfig.BLOCK_SIZE,(j+.5)*a.GameConfig.BLOCK_SIZE),m=new Phaser.Point((i+.5)*a.GameConfig.BLOCK_SIZE,(h+.5)*a.GameConfig.BLOCK_SIZE),n=this.game.add.tween(this._selectedGem).to({x:l.x,y:l.y},a.GameConfig.SWAP_TIME,Phaser.Easing.Linear.None,!1);this._tweenArray.push(n);var o=this.game.add.tween(this._pickedGem).to({x:m.x,y:m.y},a.GameConfig.SWAP_TIME,Phaser.Easing.Linear.None,!1);this._tweenArray.push(o);var p=this._selectedGem.mytype,q=this._pickedGem.mytype;o.onComplete.add(function(){if(null!==c._selectedGem&&void 0!==c._selectedGem&&void 0!==c._pickedGem&&null!==c._pickedGem&&(c._selectedGem.isBomb||c._pickedGem.isBomb)){c._removeMap=[];for(var a=0;a<c._gameArray.length;a++){c._removeMap[a]=[];for(var d=0;d<c._gameArray[a].length;d++)c._removeMap[a].push(0)}c._selectedGem.isBomb?(c.setOff(c._selectedGem.mytype-5,c._selectedGem.row,c._selectedGem.col),c.destroyGems()):(c._selectedGem=c._pickedGem,c.setOff(c._selectedGem.mytype-5,c._selectedGem.row,c._selectedGem.col),c.destroyGems())}else c.isMatchOnBoard(j,k,p,h,i,q)?(c.handleMatches(),c._selectedGem=null,c._pickedGem=null):b&&c.swapGems(!1)},this),o.start(),n.start(),b||(this._selectedGem.deselect(),this._selectedGem=null,this._pickedGem=null,this._canClick=!0)},c.prototype.isMatchOnBoard=function(a,b,c,d,e,f){return this.isMatch(a,b,c)||this.isMatch(d,e,f)},c.prototype.isMatch=function(a,b,c){return this.isHorizontal(a,b,c)||this.isVertical(a,b,c)},c.prototype.isHorizontal=function(a,b,c){for(var d,e,f=0,g=0;g<3;g++)if(f=0,d=b+g,e=d-2,!(d>=this._gameArray[0].length||e<0)){for(var h=d;h>=e;h--)this._gameArray[a][h].mytype==c&&f++;if(f>2)return!0}return!1},c.prototype.setOff=function(a,b,c){if(null==b){if(!this._selectedGem.isBomb||a<1)return;if(!this._canClick)return}this._canClick=!1,this._boomAnimation=!0;var d;switch(void 0!==b&&null!==b?d=new Phaser.Point(b,c):(d=new Phaser.Point(this._selectedGem.row,this._selectedGem.col),this._selectedGem.stopTween()),this._bombPosition=d,this._selectedGem=null,this._pickedGem=null,this._bombRange=a,a){case 1:for(var e=-1;e<2;e++){var f=void 0,g=void 0;d.x+e>=0&&d.x+e<this._gameArray.length&&(f=d.x+e,g=d.y,!this._gameArray[f][g].isBomb||f==d.x&&g==d.y||0!=this._removeMap[f][g]||this.setOff(this._gameArray[f][g].mytype-5,f,g),this._gameArray[f][g].mytype>0&&(this._removeMap[f][g]=1)),d.y+e>=0&&d.y+e<this._gameArray[0].length&&(f=d.x,g=d.y+e,!this._gameArray[f][g].isBomb||f==d.x&&g==d.y||0!=this._removeMap[f][g]||this.setOff(this._gameArray[f][g].mytype-5,f,g),this._gameArray[f][g].mytype>0&&(this._removeMap[f][g]=1))}}this._coolAnimation=!1},c.prototype.isVertical=function(a,b,c){for(var d,e,f=0,g=0;g<3;g++)if(f=0,d=a+g,e=d-2,!(d>=this._gameArray.length||e<0)){for(var h=d;h>=e;h--)this._gameArray[h][b].mytype==c&&f++;if(f>2)return!0}return!1},c.prototype.handleMatches=function(){var a=this;this._firstMatch||(this._firstMatch=!0,this._firstMatchCallback&&this._firstMatchCallback()),this._removeMap=[];for(var b=0;b<this._gameArray.length;b++){this._removeMap[b]=[];for(var c=0;c<this._gameArray[b].length;c++)this._removeMap[b].push(0)}this.handleHorizontalMatches(),this.handleVerticalMatches(),this._sequences.forEach(function(b){for(var c=0;c<b.length;c++){var d=b.get(c);a._removeMap[d.x][d.y]=1}}),this.destroyGems(),this._coolAnimation=!1},c.prototype.destroyGems=function(){var b=this;this._destroyed=0;var c;if(null!=this._selectedGem)if(this._removeMap[this._selectedGem.row][this._selectedGem.col]>0){c=new Phaser.Point(this._selectedGem.x,this._selectedGem.y),this._selectedGem.mytype,this._condensationPoint.set(this._selectedGem.row,this._selectedGem.col);for(var d=0;d<this._sequences.length;){var e=this._sequences[d];if(e.contains(this._condensationPoint.x,this._condensationPoint.y)){e.isBomb&&e.setBombPosition(this._condensationPoint.x,this._condensationPoint.y);break}d++}}else if(this._removeMap[this._pickedGem.row][this._pickedGem.col]>0){c=new Phaser.Point(this._pickedGem.x,this._pickedGem.y),this._pickedGem.mytype,this._condensationPoint.set(this._pickedGem.row,this._pickedGem.col);for(var d=0;d<this._sequences.length;){var e=this._sequences[d];if(e.contains(this._condensationPoint.x,this._condensationPoint.y)){e.isBomb&&e.setBombPosition(this._condensationPoint.x,this._condensationPoint.y);break}d++}}else c=new Phaser.Point(1,1),0;if(this._sequences.length>0)1==this._sequences.length&&this._sequences[0].length>3&&c?(c.x=(this._condensationPoint.y+.5)*a.GameConfig.BLOCK_SIZE,c.y=(this._condensationPoint.x+.5)*a.GameConfig.BLOCK_SIZE,this._sequences.forEach(function(a){a.forEach(function(a){var d=b._gameArray[a.x][a.y];b.game.add.tween(d).to({x:c.x,y:c.y},300,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.addOnce(function(){b.destroyGem(d,!1,!0)})}),b.playMatchSound(a.length)})):this._sequences.forEach(function(a){a.forEach(function(a){var c=b._gameArray[a.x][a.y];b.destroyGem(c)}),b.playMatchSound(a.length)}),this._destroyed=0,this.game.time.events.add(400,this.makeGemsFall,this);else if(1==this._bombRange){for(var f=this._bombPosition.x,g=this._bombPosition.y,d=0;d<this._removeMap.length;d++)for(var h=0;h<this._removeMap[d].length;h++)this._removeMap[d][h]>0&&(d!=f||h!=g)&&this.destroyGem(this._gameArray[d][h],!0);window.sounds&&this.game.sound.play("1",.4),this._gameArray[f][g].playDestroy(1),this.game.time.events.add(750,this.makeGemsFall,this)}else{for(var f=this._bombPosition.x,g=this._bombPosition.y,d=this._bombPosition.x,h=this._bombPosition.x,i=this._bombPosition.y,j=this._bombPosition.y,k=1;k<Math.max(this._gameArray.length,this._gameArray[0].length);k++)d-k>=0&&this._gameArray[d-k][g].mytype>0&&(this.destroyGem(this._gameArray[d-k][g]),this._removeMap[d-k][g]=1),h+k<this._gameArray.length&&this._gameArray[h+k][g].mytype>0&&(this.destroyGem(this._gameArray[h+k][g]),this._removeMap[h+k][g]=1),i-k>=0&&this._gameArray[f][i-k].mytype>0&&(this.destroyGem(this._gameArray[f][i-k]),this._removeMap[f][i-k]=1),j+k<this._gameArray[0].length&&this._gameArray[f][j+k].mytype>0&&(this.destroyGem(this._gameArray[f][j+k]),this._removeMap[f][j+k]=1);this._removeMap[f][g]=1;var l=this._gameArray[f][g];this._gameArray[f][g].playDestroy(0),this.game.time.events.add(750,this.makeGemsFall,this),window.sounds&&this.game.sound.play("12",.4),this._lightnings.forEach(function(a){a.alpha=1,a.position.set(l.x,l.y),a.play("play")})}this._bombRange=0},c.prototype.playMatchSound=function(a){var b=a-3;if(!(b<0)){var c=[17,16,15,14];b>c.length&&(b=c.length-1),window.sounds&&this.game.sound.play(c[b].toString(),.4)}},c.prototype.destroyGem=function(b,c,d){var e=this;void 0===c&&(c=!1),void 0===d&&(d=!1);var f;if(f=this._bombRange>1?1:this.game.rnd.between(3,5),this._counter++,b.mytype>0)for(var g=this,h=0;h<f;h++)!function(c){var d=g.game.rnd.between(0,Phaser.Math.PI2),h=new Phaser.Point(Math.sin(d),Math.cos(d)),i=g.game.rnd.between(30,50);h.setMagnitude(i);var j=b.worldPosition.clone();h.x+=j.x,h.y+=j.y;var k;if(b.mytype>5){var l=+b._sprite.frameName.split("_")[1];k=new a.GemPatricle(g.game,h.x,h.y,l)}else k=new a.GemPatricle(g.game,h.x,h.y,b.mytype);g.game.world.addChild(k);var m=g._playState.getGurrentElementPosition("foo"),n=900+g.game.rnd.integerInRange(-100,200);g.game.add.tween(k.scale).to({x:3.5,y:3.5},n/2,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0),g.game.add.tween(k).to({x:[k.x,Math.max(k.x-m.x,m.x-k.x)/2+g.game.rnd.integerInRange(-400,800),m.x],y:[k.y,Math.max(k.y-m.y,m.y-k.y)/2+g.game.rnd.integerInRange(-400,400),m.y]},n,Phaser.Easing.Sinusoidal.Out,!0,100).interpolation(function(a,b){return Phaser.Math.bezierInterpolation(a,b)}).onComplete.add(function(){if(c==f-1&&e._cb(1,1),window.sounds&&Math.random()<.5){var a=["21","22","23"];e.game.sound.play(Phaser.ArrayUtils.getRandomItem(a),.2)}k.destroy()},g)}(h);d?b.playDestroy(22):b.playDestroy(0)},c.prototype.render=function(){this.game.debug.text("foobar 100",10,20),this._gameArray&&this._gameArray[2][2].render()},c.prototype.handleHorizontalMatches=function(){for(var b=this,c=0;c<this._gameArray.length;c++)!function(c){for(var d=1,e=-100500,f=0,g=0;g<b._gameArray[c].length;g++)if(b._gameArray[c][g].mytype==e&&b._gameArray[c][g].mytype>0&&++d>=4&&(b._createBomb=!0,b._maxColorStreak=Math.max(b._maxColorStreak,d)),b._gameArray[c][g].mytype!=e||g==b._gameArray[c].length-1){if(d>=3){var h=new a.Sequence;b._sequences.push(h);for(var i=b._sequences.length-1,j=0;j<d;j++)!function(a){var d=i;b._sequences.forEach(function(b,e){b.contains(c,f+a)&&(d=e)}),d!=i?(b._sequences[d].merge(h),h=b._sequences[d],i=d):h.add(c,f+a)}(j)}f=g,d=1,e=b._gameArray[c][g].mytype}}(c)},c.prototype.handleVerticalMatches=function(){for(var b=this,c=0;c<this._gameArray[0].length;c++)!function(c){for(var d=1,e=-100500,f=0,g=0;g<b._gameArray.length;g++)if(b._gameArray[g][c].mytype==e&&b._gameArray[g][c].mytype>0&&++d>=4&&(b._createBomb=!0,b._maxColorStreak=Math.max(b._maxColorStreak,d)),b._gameArray[g][c].mytype!=e||g==b._gameArray.length-1){if(d>=3){var h=new a.Sequence;b._sequences.push(h);for(var i=b._sequences.length-1,j=0;j<d;j++)!function(a){var d=i;b._sequences.forEach(function(b,e){b.contains(f+a,c)&&(d=e)}),d!=i?(b._sequences[d].merge(h),h=b._sequences[d],i=d):h.add(f+a,c)}(j)}f=g,d=1,e=b._gameArray[g][c].mytype}}(c)},c.prototype.checkGlobalMatch=function(){for(var a=0;a<this._gameArray.length;a++)for(var b=0;b<this._gameArray[a].length;b++)if(!(this._gameArray[a][b].mytype<=0)&&this.isMatch(a,b,this._gameArray[a][b].mytype))return!0;return!1},c.prototype.swap=function(a,b,c,d,e){void 0===e&&(e=0);var f=this._gameArray[a][b];f.row=c-e,f.col=d,this._gameArray[a][b]=this._gameArray[c][d],this._gameArray[a][b].row=a-e,this._gameArray[a][b].col=b,this._gameArray[c][d]=f},c.prototype.makeGemsFall=function(){var b=this;this._destroyed>0&&this.game.time.events.add(200,this.makeGemsFall,this),this._sequences.forEach(function(c){if(c.isBomb){var d=c.bombPosition;b._removeMap[d.x][d.y]=0;var e=b._gameArray[d.x][d.y];try{b.game.world.removeChild(e),b._container.addChild(e)}catch(a){}e.x=(e.col+.5)*a.GameConfig.BLOCK_SIZE,e.y=(e.row+.5)*a.GameConfig.BLOCK_SIZE,e.spawnBoom(c.length),b._maxColorStreak=0,b._createBomb=!1,b._boomAnimation=!1}}),this._turnOffMask&&(this._turnOffMask=!1,this._container.mask=this._myMask),this._sequences.length=0;for(var c=this.findHoles(),d=[],e=0,f=0;f<c.length;f++){var g=c[f],h=void 0,i=void 0,j=void 0;g.hasHoleAbove?(h=c[f+1],i=h.row+h.length-g.length,j=g.row-i):(i=0,j=g.row-this._fieldUpperBound[g.col]);for(var k=0;k<j;k++)this.swap(g.row-1-k,g.col,g.row+g.length-1-k,g.col);if(g.hasHoleAbove){var l=g.row-(h.row+h.length-g.length);i=g.row+g.length-l,j=g.row+g.length}else{for(var k=this._fieldUpperBound[g.col];k<this._fieldUpperBound[g.col]+g.length;k++){var m=this._gameArray[k][g.col],n=this.game.rnd.between(1,5);m.mytype=n,m.x=(g.col+.5)*a.GameConfig.BLOCK_SIZE,m.y=(m.row-g.length+.5)*a.GameConfig.BLOCK_SIZE}i=this._fieldUpperBound[g.col],j=g.row+g.length}for(var o=this,k=i;k<j;k++)!function(c){var f=o._gameArray[c][g.col];e++;var h=o.game.add.tween(f).to({y:f.y+g.length*a.GameConfig.BLOCK_SIZE},a.GameConfig.FALLDOWN_TIME,Phaser.Easing.Back.Out,!1);o._tweenArray.push(h),h.onComplete.add(function(){b._gameArray[f.row][f.col]=f,0==--e&&(b.checkGlobalMatch()?b.handleMatches():(b.moveExists()?b._canClick=!0:b.resetBoard(),b._selectedGem=null,b._finalWasFired||b._counter>=window.totalElemets&&(b._finalWasFired=!0,a.GameConfig.COUNTERS_PUBLIC=[0,window.firstElement,0,window.secondElement,window.thirdElement,0,100,100],b.endGame())))}),d.push(h)}(k)}d.forEach(function(a){return a.start()})},c.prototype.createFlyTween=function(b,c,d){var e=this,f=this.game.add.tween(b.scale).to({x:a.GameConfig.PANEL_GEM_SCALE,y:a.GameConfig.PANEL_GEM_SCALE},a.GameConfig.FLY_TIME,Phaser.Easing.Sinusoidal.InOut,!1);this._tweenArray.push(f),f.onComplete.addOnce(function(){b.scale.setTo(1)},this);var g=this.game.add.tween(b).to({x:c.x,y:c.y},a.GameConfig.FLY_TIME,Phaser.Easing.Sinusoidal.InOut,!1,d);return this._tweenArray.push(g),this._gem1ToFollow=b,g.onStart.addOnce(function(){window.particleOn&&100*e._destroyed==d+100&&(e._fruitSpecialEmmiter1.x=e._gem1ToFollow.x,e._fruitSpecialEmmiter1.y=e._gem1ToFollow.y,e._fruitSpecialEmmiter1.on=!0,e._followGem1=!0),f.start()}),g.onComplete.add(function(a,c){if(b){if(window.particleOn){1==e._destroyed&&(e._fruitSpecialEmmiter1.on=!1,e._followGem1=!1);for(var d=void 0;d<e._tempSprite.length;d++)if(e._tempSprite[d]==b){e._tempSprite.splice(d,1);break}}e.game.world.removeChild(b),e._container.addChild(b),b.position.set(-1500,-1500),e._destroyed--,e._cb(b.mytype,1),e._counter++,e._boomAnimation&&(e._boomAnimation=!1),0==e._destroyed&&e.makeGemsFall()}},this),g},c.prototype.updateSpecialGemEmmiter=function(){this._followGem1&&(this._fruitSpecialEmmiter1.x=this._gem1ToFollow.x,this._fruitSpecialEmmiter1.y=this._gem1ToFollow.y)},Object.defineProperty(c.prototype,"gameArray",{get:function(){for(var a=[],b=0;b<this._gameArray.length;b++){a.push([]);for(var c=0;c<this._gameArray[b].length;c++)a[b][c]=this._gameArray[b][c].mytype}return a},enumerable:!0,configurable:!0}),c.prototype.generateFlyAwayTween=function(b,c,d,e){this._container.removeChild(b),this.addChild(b);var f=this.createFlyTween(b,d,e);if(this._verticalAnimation)return f;var g=this.game.add.tween(b).to({x:c.x},a.GameConfig.CONDENSATION_TIME,Phaser.Easing.Linear.None,!1);return this._tweenArray.push(g),g.onComplete.add(function(a,b){f.start()}),g},c.prototype.condensate=function(a){for(var b=[],c=0,d=0;d<this._removeMap.length;d++)for(var e=0;e<this._removeMap[d].length;e++)if(this._removeMap[d][e]>0){this._destroyed++;var f=this._gameArray[d][e],g=void 0;g=2==f.mytype?this._playState.getGurrentElementPosition("second"):this._playState.getGurrentElementPosition("first"),b.push(this.generateFlyAwayTween(f,a,g,c)),b[b.length-1].onStart.addOnce(function(){}),c+=100}b.forEach(function(a){a.start()})},c.prototype.findHoles=function(){for(var a=[],b=0;b<this._gameArray[0].length;b++)for(var c=this._gameArray.length-1;c>=0;c--)if(this._removeMap[c][b]>0){for(var d=1,e=c,f=!0,g=!1,h=c-1;h>=0;h--)if(this._removeMap[h][b]>0)d++,e=h,f=!0,g=!1;else if(f){a.push({row:e,col:b,length:d,hasHoleAbove:!1}),f=!1,g=!0;var i=a.length-2;i>=0&&a[i].col==a[i+1].col&&(a[i].hasHoleAbove=!0)}if(!g){a.push({row:e,col:b,length:d,hasHoleAbove:!1});var i=a.length-2;i>=0&&a[i].col==a[i+1].col&&(a[i].hasHoleAbove=!0)}break}return a},c.prototype.update=function(){window.particleOn},c.prototype.destroy=function(){var a=this;this.clearTweens(),setTimeout(function(){a.game.input.onUp.removeAll(a),a.game.tweens.removeFrom(a,!0),b.prototype.destroy.call(a,!0)},10)},c}(Phaser.Sprite);a.Field=b}(mygame||(mygame={}));var mygame;!function(a){var b=function(){function a(){}return a.deepClone=function(a){for(var b=[],c=0;c<a.length;c++){b.push([]);for(var d=0;d<a[0].length;d++)b[c].push(a[c][d])}return b},a.transpose=function(a){for(var b=[],c=0;c<a[0].length;c++){b.push([]);for(var d=0;d<a.length;d++)b[c].push(a[d][c])}return b},a.enableDrag=function(a){},a}();b.BLOCK_SIZE=92,b.SWAP_TIME=150,b.DESTROY_TIME=150,b.FALLDOWN_TIME=400,b.FLY_TIME=575,b.CONDENSATION_TIME=300,b.COUNTERS=[0,2,1,0,0,0,0,0],b.COUNTERS_PUBLIC=[0,2,1,0,0,0,0,0],b.NAMES=["apple","apple","grapes","flower","pear","leaf"],b.PANEL_GEM_SCALE=.8,b.APPLE_POS=new Phaser.Point(100,-60),b.GRAPES_POS=new Phaser.Point(370,-60),b.UNLOCK_OBJ_PER_FRUITS=3,b.GEM_DEFAULT_SCALE=1,b.gameArrayLandscape=[[-1,5,3,2,4,1,-1],[2,3,3,2,1,1,5],[3,1,2,4,4,5,1],[4,3,5,2,4,5,1],[-1,5,4,1,5,4,-1]],a.GameConfig=b}(mygame||(mygame={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),mygame;!function(a){var b=function(b){function c(c,d,e,f){var g=b.call(this,c,d,e)||this;return g._tempTweenArray=[],g._blinks=[],g._mytype=f,g._spriteName=a.GameConfig.NAMES[g._mytype],f>0&&(g._canPlayBlibk=!0,g._sprite=g.game.add.sprite(0,0,"atlas2","F_"+g._mytype),g._sprite.anchor.set(.5),g.addChild(g._sprite),g._boom=g.game.add.sprite(0,0,"atlas2","F_1"),g._boom.anchor.set(.5),g._boom.visible=!1,g.addChild(g._boom),g._destroyAnimation=g._sprite.animations.add("set off",Phaser.Animation.generateFrameNames("F_",g._mytype,g._mytype),18,!1),g._destroyAnimation.onStart.add(function(){g._sprite.alpha=1},g),g._bombBoomAnimation=g._boom.animations.add("b_bomb",Phaser.Animation.generateFrameNames("bb_",1,10),18,!1),g._border=g.game.add.sprite(0,0,"atlas2","selection"),g._border.anchor.set(.5),g._border.scale.set(.7),g.addChild(g._border),g._border.alpha=0,g._destroyAnimation.onComplete.add(function(){g.animationEnd()},g),g._bombTween=g.game.add.tween(g._sprite.scale).to({x:1.1,y:1.1},500,Phaser.Easing.Sinusoidal.InOut,!1,0,-1,!0),g._sprite.alpha=1,g._lightningSprite=g.game.add.sprite(0,0,"atlas2","light_line_10001"),g._lightningSprite.anchor.set(.5),g._lightningSprite.alpha=0,g._lightningSprite.animations.add("play",Phaser.Animation.generateFrameNames("light_line_",10001,10022),24).onComplete.add(function(){g._lightningSprite.alpha=0},g),g.addChild(g._lightningSprite),g.createBlink(),g.createRemoveAnimation(),g.createBombAnimation()),g}return __extends(c,b),c.prototype.createBombAnimation=function(){var a=this;this._bomb=this.game.add.sprite(0,0,"atlas2","boom_8"),this._bomb.scale.set(1.5),this._bomb.anchor.set(.5),this._bomb.alpha=0,this.addChild(this._bomb);var b=this._bomb.animations.add("play",Phaser.Animation.generateFrameNames("boom_",8,29),30);this._bombAnimation=b,b.onStart.add(function(){a._canPlayBlibk=!1,a._blinkSprite.alpha=0,a._mytype<=5&&a._blinks[a._mytype-1].stop(),a._sprite.alpha=0,a._bomb.alpha=1}),b.onComplete.add(function(){a._bomb.alpha=0})},c.prototype.createRemoveAnimation=function(){var a=this;this._removeSprite=this.game.add.sprite(0,0,"atlas2","remove_anim_10001"),this._removeSprite.anchor.set(.5),this._removeSprite.alpha=0,this.addChild(this._removeSprite);var b=this._removeSprite.animations.add("play",Phaser.Animation.generateFrameNames("remove_anim_",10001,10018),24);this._removeAnimation=b,b.onStart.add(function(){a._canPlayBlibk=!1,a._blinkSprite.alpha=0,a._mytype<=5&&a._blinks[a._mytype-1].stop(),a._sprite.alpha=0,a._removeSprite.alpha=1}),b.onComplete.add(function(){a._removeSprite.alpha=0})},c.prototype.render=function(){this.game.debug.spriteBounds(this._sprite),this.game.debug.spriteInfo(this._sprite,100,100,"#00ff00")},c.prototype.playBlink=function(){this._mytype>0&&this._canPlayBlibk&&this._mytype<=5&&(this._blinkSprite.alpha=1,this._blinks[this._mytype-1].play())},c.prototype.createBlink=function(){var a=this;this._blinkSprite=this.game.add.sprite(0,0,"atlas2","yellow_blink_10013"),this._blinkSprite.alpha=0,this._blinkSprite.anchor.set(.5),this.addChild(this._blinkSprite);for(var b=["blue","green","pink","red","yellow"],c=0;c<5;c++){var d=this._blinkSprite.animations.add("blink_"+b[c],Phaser.Animation.generateFrameNames(b[c]+"_blink_",10001,10025),12);d.onStart.add(function(){a._blinkSprite.alpha=1},this),d.onComplete.add(function(){a._blinkSprite.alpha=0},this),this._blinks.push(d)}},c.prototype.animationEnd=function(){this._onCompleteFired||(this._onCompleteFired=!0,this._sprite.alpha=0,this._destroyCallback&&(this._onCompleteFired=!0,this._destroyCallback()))},c.prototype.boomAnimation=function(){this._sprite.alpha=0,this._mytype>=6?this._bombBoomAnimation.play():this._boomAnimation.play()},c.prototype.spawnBoom=function(a){a>3&&(this._border.alpha=0,4==a?(this._boom.loadTexture("atlas2","bomb_icon"),this._boom.anchor.set(.45,.6),this._sprite.alpha=1,this._boom.alpha=1,this._boom.visible=!0,this._mytype=6):(this._boom.loadTexture("atlas2","wert_horiz_icon"),this._boom.anchor.set(.5),this._boom.alpha=1,this._boom.visible=!0,this._sprite.alpha=1,this._mytype=7),this._sprite.alpha=1,this._onCompleteFired=!1,this._destroyAnimation.stop())},c.prototype.stopTween=function(){this._bombTween.pause(),this._sprite.loadTexture("atlas2","F_2"),this._sprite.alpha=0},Object.defineProperty(c.prototype,"row",{get:function(){return this._row},set:function(a){this._row=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"col",{get:function(){return this._col},set:function(a){this._col=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"mytype",{get:function(){return this._mytype},set:function(b){this._border.alpha=0,this._onCompleteFired||(this._destroyAnimation.stop(),this._onCompleteFired=!0),this._destroyAnimation.stop(),this._mytype=b,b<6?(this._canPlayBlibk=!0,this._sprite.alpha=1,this._bombTween.pause(),this._sprite.position.set(0,0),this._sprite.scale.set(a.GameConfig.GEM_DEFAULT_SCALE,a.GameConfig.GEM_DEFAULT_SCALE),this._spriteName=a.GameConfig.NAMES[this._mytype],this._sprite.loadTexture("atlas2","F_"+this._mytype)):(this._bombTween.start(),this._spriteName="rocket",this._sprite.loadTexture("atlas2","bomb_icon"),this._sprite.scale.set(1,1)),this._sprite.alpha=1,this._onCompleteFired=!1},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"onDestroy",{set:function(a){this._destroyCallback=a},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"isBomb",{get:function(){return this._mytype>=6},enumerable:!0,configurable:!0}),c.prototype.foo=function(){},c.prototype.lightning=function(a){this._canPlayBlibk=!1,this._blinkSprite.alpha=0,this._lightningSprite.angle=a,this._lightningSprite.alpha=1,this._lightningSprite.play("play"),this._sprite.alpha=0},c.prototype.playDestroy=function(a){void 0===a&&(a=0),this._border.alpha=0,this._boom.visible=!1,6==this.mytype&&this._bombTween.pause(),1==a?(this._bomb.alpha=1,this._bombAnimation.play()):0==a&&(this._removeSprite.tint=16777215,this._removeAnimation.play())},c.prototype.select=function(){window.tutorial||(this._sprite.scale.set(a.GameConfig.GEM_DEFAULT_SCALE+.2),this.mytype<6&&(this._border.alpha=1))},c.prototype.deselect=function(){this._sprite.scale.set(a.GameConfig.GEM_DEFAULT_SCALE),this._border.alpha=0},c.prototype.isSame=function(a){return this._row==a.row&&this._col==a.col},c.prototype.isNext=function(a){return Math.abs(this.row-a.row)+Math.abs(this.col-a.col)==1},c}(Phaser.Sprite);a.Gem=b}(mygame||(mygame={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),mygame;!function(a){var b=function(a){function b(b,c,d,e){var f=a.call(this,b,c,d)||this;return f.PARTICLE_NAMES=["blue","green","pink","red","yellow"],f._sprite=f.game.add.sprite(0,0,"atlas2","particle_"+f.PARTICLE_NAMES[e-1]),f.addChild(f._sprite),f._sprite.anchor.set(.5),f}return __extends(b,a),b.prototype.destoy=function(){this._sprite.destroy(),a.prototype.destroy.call(this)},b}(Phaser.Sprite);a.GemPatricle=b}(mygame||(mygame={}));var mygame;!function(a){var b=function(){function a(){this.CONGRAT={en:"Congratulations!",de:"  Herzlichen Gluckwunsch !"},this.PLOT={en:"The plot\nis restored!",de:"Ein Grundstuck\nrestauriert!"},this.TUTORIAL={en:"Collect fruits to upgrade garden!",de:"Sammeln Sie Fruchte,\num den Garten zu verbessern!"}}return Object.defineProperty(a,"Instance",{get:function(){return null!==this.instance&&void 0!==this.instance||(this.instance=new a),this.instance},enumerable:!0,configurable:!0}),a}();b.loc="en",a.Lang=b}(mygame||(mygame={}))
;var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),mygame;!function(a){var b=function(b){function c(c,d,e){var f=b.call(this,c,d,e)||this;return f._tweenRun=!1,f._delta=0,f._unclocksCounter=0,f._total=window.totalElemets,f._counter=0,f._statusText=f.game.add.bitmapText(0,-73,"font",f._counter+"/"+f._total,60),f._statusText.anchor.set(.5),f._bigHouse=[],f._smallHouse=[],f._bridge=[],f._fireworks=[],f._myMask=f.game.add.graphics(0,0),f.addChild(f._myMask),f._city=f.game.add.sprite(0,0,"atlas2","cityCorrect"),f._city.anchor.set(.5,1),f._city.mask=f._myMask,f._orange=f.game.add.sprite(0,-275,"atlas2","gold_city_back0X25"),f._orange.anchor.set(.5,.5),f._orange.scale.set(4,4),f.addChild(f._orange),f.addChild(f._city),f._fruitsCounter=0,f._finishWasFired=!1,f._fruitScale=.8,a.GameConfig.COUNTERS_PUBLIC=[999,999,999,999,999,999],f._scorePlank=f.game.add.sprite(0,200,"atlas2","scorePlank"),f._scorePlank.anchor.set(.5,1),f.addChild(f._scorePlank),f.createBigHouses(),f.createSmallHouses(),f.createBridges(),f.createProgressBar(),f._scorePlank.addChild(f._statusText),f._delta=0,f._timer=0,f._sleepTime=1,a.Core.isLandscape?f.setLandscape():f.setPortrait(),f}return __extends(c,b),c.prototype.createBigHouses=function(){for(var a=this,b=["start","end"],c=0;c<2;c++){var d=this.game.add.sprite(-212,-654,"atlas2","bigHouse_"+b[c]);this._bigHouse.push(d),this._city.addChild(d),d.alpha=1-c}for(var e=[[-23,-544],[-165,-500],[-150,-642]],f=this,c=0;c<3;c++)!function(b){var c=f.game.add.sprite(e[b][0],e[b][1],"atlas2","image_1");c.anchor.set(.5),c.alpha=0,c.animations.add("play",Phaser.Animation.generateFrameNames("image_",1,19),20).onComplete.add(function(){a.game.add.tween(c.scale).to({x:1.3,y:1.3},500,Phaser.Easing.Sinusoidal.InOut,!0),a.game.add.tween(c).to({alpha:0},500,Phaser.Easing.Sinusoidal.InOut,!0)},f),f._city.addChild(c),f._fireworks.push(c)}(c)},c.prototype.createSmallHouses=function(){for(var a=this,b=["start","end"],c=0;c<2;c++){var d=this.game.add.sprite(-5,-565,"atlas2","smallHouse_"+b[c]);this._smallHouse.push(d),this._city.addChild(d),d.alpha=1-c}for(var e=[[233,-511],[135,-480],[182,-535]],f=this,c=0;c<3;c++)!function(b){var c=f.game.add.sprite(e[b][0],e[b][1],"atlas2","image_1");c.anchor.set(.5),c.alpha=0,c.animations.add("play",Phaser.Animation.generateFrameNames("image_",1,19),20).onComplete.add(function(){a.game.add.tween(c.scale).to({x:1.3,y:1.3},500,Phaser.Easing.Sinusoidal.InOut,!0),a.game.add.tween(c).to({alpha:0},500,Phaser.Easing.Sinusoidal.InOut,!0)},f),f._city.addChild(c),f._fireworks.push(c)}(c)},c.prototype.createBridges=function(){for(var a=this,b=["start","end"],c=0;c<2;c++){var d=this.game.add.sprite(-43,-303,"atlas2","bridge_"+b[c]);this._bridge.push(d),this._city.addChild(d),d.alpha=1-c}for(var e=[[17,-276],[25,-330],[83,-300]],f=this,c=0;c<3;c++)!function(b){var c=f.game.add.sprite(e[b][0],e[b][1],"atlas2","image_1");c.anchor.set(.5),c.alpha=0,c.animations.add("play",Phaser.Animation.generateFrameNames("image_",1,19),20).onComplete.add(function(){a.game.add.tween(c.scale).to({x:1.3,y:1.3},500,Phaser.Easing.Sinusoidal.InOut,!0),a.game.add.tween(c).to({alpha:0},500,Phaser.Easing.Sinusoidal.InOut,!0)},f),f._city.addChild(c),f._fireworks.push(c)}(c)},c.prototype.createProgressBar=function(){this._progressBar=this.game.add.sprite(0,0);var a=this.game.add.sprite(0,0,"scoreMetr");a.anchor.set(1,1);var b=this.game.add.sprite(0,0,"scoreMetr");b.scale.set(-1,1),b.anchor.set(1,1);var c=2*a.width-30,d=a.height-8,e=this.game.add.graphics(0,0);e.beginFill(2303780).drawRect(-c/2,-d-4,c,d).endFill(),e.cacheAsBitmap=!0,this._greenBar=this.game.add.graphics(0,0),this._progressBar.addChild(e),this._progressBar.addChild(this._greenBar),this._progressBar.addChild(a),this._progressBar.addChild(b),this._scorePlank.addChild(this._progressBar)},Object.defineProperty(c.prototype,"greenbarValue",{set:function(a){this._greenBar.clear().beginFill(3650894).drawRect(-126,-36,252*a,32).endFill()},enumerable:!0,configurable:!0}),c.prototype.scaleFruits=function(a){},Object.defineProperty(c.prototype,"finishScreenCallback",{set:function(a){this._finishCallback=a},enumerable:!0,configurable:!0}),c.prototype.updateStatus=function(){this._counter>this._total&&(this._counter=this._total),this._statusText.text=this._counter+"/"+this._total,this.greenbarValue=this._counter/this._total},c.prototype.replay=function(){this._finishWasFired=!1,this._delta=0,this._counter=0,this._unclocksCounter=0},c.prototype.updateCounter=function(a,b){this._delta+=b,this._sleepTime=200},c.prototype.setLandscape=function(){this._myMask.clear(),this._orange.angle=0,this._orange.position.set(0,-275),this._city.position.set(-35,50),this._city.scale.set(1,1),this._myMask.y=-273,this._myMask.beginFill(16777215),this._myMask.drawRoundedRect(-c._myMaskSize[0]/2,-c._myMaskSize[1]/2,c._myMaskSize[0],c._myMaskSize[1],20),this._myMask.endFill(),this._scorePlank.position.set(0,70)},c.prototype.setPortrait=function(){this._city.position.set(-10,150),this._city.scale.set(1.1,1.1),this._myMask.position.set(0,-240),this._myMask.clear(),this._myMask.beginFill(16777215),this._myMask.drawRoundedRect(-c._otherMaskSize[0]/2,-c._otherMaskSize[1]/2,c._otherMaskSize[0],c._otherMaskSize[1],20),this._myMask.endFill(),this._orange.angle=90,this._orange.position.set(0,-240),this._scorePlank.position.set(0,85)},c.prototype.getElementPosition=function(b){return a.Core.isLandscape?new Phaser.Point(this._scorePlank.worldPosition.x,this._scorePlank.worldPosition.y-70):new Phaser.Point(this._scorePlank.worldPosition.x,this._scorePlank.worldPosition.y-50)},c.prototype.initFruits=function(){},c.prototype.unlockObject=function(){var a=this;switch(this._unclocksCounter){case 0:window.sounds&&this.game.sound.play("3",.4),window.sounds&&this.game.sound.play("19",.4);for(var b=this,c=this._fireworks.length-3;c<this._fireworks.length;c++)!function(c){b.game.time.events.add(100*c,function(){a._fireworks[c].alpha=1,a._fireworks[c].play("play",24)},b)}(c);this.game.add.tween(this._bridge[1]).to({alpha:.7},1e3,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.addOnce(function(){a.game.add.tween(a._bridge[1]).to({alpha:1},750,Phaser.Easing.Sinusoidal.InOut,!0),a.game.add.tween(a._bridge[0]).to({alpha:0},750,Phaser.Easing.Sinusoidal.InOut,!0)},this);break;case 1:window.sounds&&this.game.sound.play("3",.4),window.sounds&&this.game.sound.play("19",.4);for(var d=this,c=this._fireworks.length-6;c<this._fireworks.length-3;c++)!function(b){d.game.time.events.add(100*b,function(){a._fireworks[b].alpha=1,a._fireworks[b].play("play",24)},d)}(c);this.game.add.tween(this._smallHouse[1]).to({alpha:.7},1e3,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.addOnce(function(){a.game.add.tween(a._smallHouse[1]).to({alpha:1},750,Phaser.Easing.Sinusoidal.InOut,!0),a.game.add.tween(a._smallHouse[0]).to({alpha:0},750,Phaser.Easing.Sinusoidal.InOut,!0)},this);break;case 2:window.sounds&&this.game.sound.play("3",.4),window.sounds&&this.game.sound.play("19",.4);for(var e=this,c=0;c<3;c++)!function(b){e.game.time.events.add(100*b,function(){a._fireworks[b].alpha=1,a._fireworks[b].play("play",24)},e)}(c);this.game.add.tween(this._bigHouse[1]).to({alpha:1},1e3,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.addOnce(function(){a.game.add.tween(a._bigHouse[1]).to({alpha:1},750,Phaser.Easing.Sinusoidal.InOut,!0),a.game.add.tween(a._bigHouse[0]).to({alpha:0},750,Phaser.Easing.Sinusoidal.InOut,!0)},this)}this._unclocksCounter++},c.prototype.hideText=function(a){},c.prototype.update=function(){var a=this.game.time.elapsedMS;this._timer>0&&(this._timer-=a),this._delta>0&&(this._timer=this._sleepTime,this._counter++,this._delta--,this._counter>=Math.floor(this._total*window.firstSpawn)&&0==this._unclocksCounter&&this.unlockObject(),this._counter>=Math.floor(this._total*window.secondSpawn)&&1==this._unclocksCounter&&this.unlockObject(),this._counter>=Math.floor(this._total*window.thirdSpawn)&&2==this._unclocksCounter&&this.unlockObject(),this.updateStatus())},c}(Phaser.Sprite);b._myMaskSize=[520,648],b._otherMaskSize=[648,520],a.Panel=b}(mygame||(mygame={}));var mygame;!function(a){var b=function(){function a(){this._array=[],this._bombPosition=null}return a.prototype.add=function(a,b){this.contains(a,b)||this._array.push(new Phaser.Point(a,b))},Object.defineProperty(a.prototype,"bombPosition",{get:function(){return this._bombPosition},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isBomb",{get:function(){if(this._array.length>3){var a=Math.floor(this._array.length/2);return null==this._bombPosition&&(this._bombPosition=new Phaser.Point(this._array[a].x,this._array[a].y)),!0}return!1},enumerable:!0,configurable:!0}),a.prototype.setBombPosition=function(a,b){this._bombPosition=new Phaser.Point(a,b)},a.prototype.forEach=function(a){this._array.forEach(a)},a.prototype.contains=function(a,b){for(var c=0;c<this._array.length;c++){var d=this._array[c];if(d.x==a&&d.y==b)return!0}return!1},a.prototype.get=function(a){return this._array[a]},a.prototype.push=function(a,b){this.add(a,b)},a.prototype.merge=function(a){for(var b=a.length,c=0;c<b;c++)this._array.push(a.pop())},Object.defineProperty(a.prototype,"length",{get:function(){return this._array.length},enumerable:!0,configurable:!0}),a.prototype.pop=function(){return this._array.pop()},a}();a.Sequence=b}(mygame||(mygame={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),mygame;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.preload=function(){this.load.crossOrigin="anonymous";var a=window.baseURL;this.game.load.image("preloaderBar",a+"assets/loader_plank.png"),this.game.load.image("scoreMetr",a+"assets/scoreMetr.png"),this.game.load.image("logo",a+"assets/logo.png")},c.prototype.create=function(){a.Controller.Instance.orientation=a.Controller.LANDSCAPE,"p"==window.orientation&&(a.Controller.Instance.orientation=a.Controller.PORTRAIT),this.game.input.touch.preventDefault=!1,this.game.stage.backgroundColor=1907997,this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,this.game.state.start("Preloader")},c}(Phaser.State);a.Boot=b}(mygame||(mygame={}));var mygame;!function(a){var b=function(){function a(){this.balance=500,this.dealTime=5,this.playerMoney=3e3,this.soundsEnabled=!0,this.width=1280,this.height=720,this.orientation=a.LANDSCAPE}return Object.defineProperty(a,"Instance",{get:function(){return null!==this.instance&&void 0!==this.instance||(this.instance=new a),this.instance},enumerable:!0,configurable:!0}),a.prototype.playSound=function(a){this.soundsEnabled},a}();b.LANDSCAPE="landscape",b.PORTRAIT="portrait",a.Controller=b}(mygame||(mygame={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),mygame;!function(a){var b=function(b){function c(){var c=b.call(this,1280,720,Phaser.CANVAS,"mdsp-creative",null,!1,!0)||this;return"client"==window.innerMode&&(window.customClientWidth=function(){return document.documentElement.clientWidth},window.customClienHeight=function(){return document.documentElement.clientHeight}),a.Core.init(1280,720),c.state.add("Boot",a.Boot,!1),c.state.add("Preloader",a.Preloader,!1),c.state.add("PlayState",a.PlayState,!1),c.state.start("Boot"),c}return __extends(c,b),c}(Phaser.Game);a.Game=b}(mygame||(mygame={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),mygame;!function(a){function b(a){void 0===a&&(a=!1);var b=0,c=0,d=0,e=0;return 0!=document.documentElement.clientWidth&&(d=document.documentElement.clientWidth,e=document.documentElement.clientHeight),b=d,c=e,window.innerWidth>window.innerHeight&&(b=window.innerWidth,c=window.innerHeight),{width:b,height:c}}var c=function(c){function d(){var a=c.call(this,!0)||this;return a._winTweens=[],a}return __extends(d,c),d.prototype.create=function(){var c=this;a.GameConfig.COUNTERS_PUBLIC=[0,window.firstElement,0,window.secondElement,window.thirdElement,0,100,100],this.game.time.advancedTiming=!0,this.game.stage.backgroundColor="#000000",this._bg=this.game.add.sprite(0,0,"bg"),this._bg.anchor.set(.5),new a.OSprite(a.Core.centerX,a.Core.centerY).myScale(1.2).otherXY(a.Core.centerY,a.Core.centerX).end().addChild(this._bg),this._winscreenShowed=!1,this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.stage.smoothed=!0,this._canShowEndScreen=!1,a.Controller.Instance.width=b().width,a.Controller.Instance.height=b().height,this._container=new a.OSprite(a.Core.centerX+200,0).otherXY(a.Core.centerY,0).end(),this.game.world.addChild(this._container),this._borders=[],this._borders[0]=this.game.add.sprite(a.Core.width,a.Core.height,"atlas2","ramk_rd"),this._borders[0].anchor.set(1,1),this._borders[1]=this.game.add.sprite(0,0,"atlas2","ramk_lt"),this._borders[3]=this.game.add.sprite(a.Core.width,0,"atlas2","ramk_rt"),this._borders[3].anchor.set(1,0),this._borders[2]=this.game.add.sprite(0,a.Core.height,"atlas2","ramk_ld"),this._borders[2].anchor.set(0,1),this._borders.forEach(function(a){return c.game.world.addChild(a)}),window.collectable&&(this._gamePanelOsprite=new a.OSprite(0,0).myTopOffset(640).otherXY(a.Core.centerY,0).otherTopOffset(595).myLeftOffset(300).end(),this._panel=new a.Panel(this.game,0,0),this.game.device.iPad&&this._gamePanelOsprite.myTopOffset(750).end(),this._gamePanelOsprite.addChild(this._panel),this._panel.initFruits()),a.GameConfig.gameArray=a.GameConfig.deepClone(a.GameConfig.gameArrayLandscape),this._logoOsprite=new a.OSprite(920,0).myTopOffset(5).otherXY(a.Core.centerY,0).otherTopOffset(5).end(),this._logo=this.game.add.sprite(0,0,"logo"),this._logo.anchor.set(.5,0),this._logoOsprite.addChild(this._logo),window.collectable?(this._container=new a.OSprite(a.Core.centerX+400-85,a.Core.centerY-70-25).otherXY(a.Core.centerY+30,a.Core.centerX+220-25).end(),this._field=new a.Field(this.game,0,0,this),this._container.addChild(this._field),this._field.destroyCallback=function(a,b){c._panel.updateCounter(a,b)},this._field.finalCallback=this.showWinScreen.bind(this)):(this._container=new a.OSprite(a.Core.centerX,a.Core.centerY).otherXY(a.Core.centerY,a.Core.centerX-80).end(),this._field=new a.Field(this.game,0,0,this),this._container.addChild(this._field),this._field.destroyCallback=function(a,b){},this._container.myScale(1).otherScale(1.15).end()),this.game.world.addChild(this._logoOsprite),this._field.firstMatchCallback=function(){},this._field.pivot.set(100*a.GameConfig.gameArray[0].length/2,100*a.GameConfig.gameArray[1].length/5),this._playFree=this.game.add.sprite(0,0,"button"),window.particleOn&&(this._fruitFallEmitter=this.game.add.emitter(0,-100,Math.ceil(4600/window.fruitSpawRate)),this._fruitFallEmitter.makeParticles("atlas2",["F_1","F_2","F_3","F_4","F_5"]),this._fruitFallEmitter.minParticleSpeed.setTo(0,200*window.fruitSpawSpeed),this._fruitFallEmitter.maxParticleSpeed.setTo(0,300*window.fruitSpawSpeed),this.createEmitter()),this._playFreeBtnOsprite=new a.OSprite(a.Core.centerX+300,0).myBottomOffset(150).myScale(1).end(),this.game.device.iPad&&this._playFreeBtnOsprite.myBottomOffset(300).end(),this._playFreeBtnOsprite.otherXY(a.Core.centerY,0).otherBottomOffset(140).otherScale(.95).end(),this._playFree.anchor.set(.5,.1);var d=this.game.add.bitmapText(0,25,"font",window.buttonText,50);if(d.anchor.set(.5,.1),this._playFree.addChild(d),this._playFree.inputEnabled=!0,this._playFree.events.onInputDown.add(function(){window.trackClick()},this),this._playFreeBtnOsprite.addChild(this._playFree),window.collectable||(this._playFree.alpha=0,this._playFree.y=300),a.Core.isLandscape||this.onPortret(),window.tutorial){this._playFreeBtnOsprite.visible=!1,this._tutorialOver=this.game.make.sprite(-610,-125,"atlas2","tutorial_mask"),this._tutorialOver.scale.set(10),this._tutorialOver.alpha=.8,this._field.addChild(this._tutorialOver);var e=this.game.add.graphics(0,-128);this._tutorialOver.addChild(e),e.beginFill(0,1),e.drawRect(0,0,256,128),e.endFill();var f=this.game.add.graphics(0,72);this._tutorialOver.addChild(f),f.beginFill(0,1),f.drawRect(0,0,128,128),f.endFill();var g=this.game.add.graphics(-128,0);this._tutorialOver.addChild(g),g.beginFill(0,1),g.drawRect(0,0,128,128),g.endFill();var h=this.game.add.graphics(128,0);this._tutorialOver.addChild(h),h.beginFill(0,1),h.drawRect(0,0,128,128),h.endFill(),this._hand=this.game.add.sprite(410-2*a.GameConfig.BLOCK_SIZE,130,"atlas2","Tutorial-arrow"),this._hand.anchor.set(.5),this._handTween=this.game.add.tween(this._hand).to({y:80},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this._field.addChild(this._hand),this._tutorialContainer=new a.OSprite(a.Core.centerX,a.Core.centerY).myBottomOffset(0).myLeftOffset(35).otherXY(a.Core.centerY,a.Core.centerX).otherRightOffset(470).otherBottomOffset(0).otherScale(.75).end(),this.game.world.addChild(this._tutorialContainer),this._charTutorialSprite=this.game.make.sprite(0,0,"atlas2","tutorial_dedula"),this._charTutorialSprite.anchor.set(0,1),this._tutorialContainer.addChild(this._charTutorialSprite),this._charTutorialSprite.position.set(0,this._charTutorialSprite.width+100),this.game.add.tween(this._charTutorialSprite).to({y:0},750,Phaser.Easing.Sinusoidal.InOut,!0),this._bubbleTutorialText=this.game.add.bitmapText(this._charTutorialSprite.width/2,-250,"font2",window.tutorialText[0],35),this._bubbleTutorialText.maxWidth=500,this._bubbleTutorialText.anchor.setTo(.5,.5),this._bubbleTutorialText.align="center",this._bubbleTutorialText.tint=7550465,this._charTutorialSprite.addChild(this._bubbleTutorialText)}setTimeout(function(){c._field.endGame()},window.endGameTimer),this._timerInstall=0,window.gameStarted,this.game.time.events.loop(Phaser.Timer.SECOND,this.tick,this)},d.prototype.createEmitter=function(){this._safeEmitter=this.game.add.emitter(0,60,70),this._safeEmitter.makeParticles("atlas2",["particle"]),this._safeEmitter.setAlpha(1,0,1e3),this._safeEmitter.setScale(.6,.1,.6,.1,1e3),this._safeEmitter.setXSpeed(-50,50),this._safeEmitter.setYSpeed(-50,50),this._safeEmitter.gravity=0,this._safeEmitter.start(!1,1e3,2),this._safeEmitter.width=this._logo.width,this._safeEmitter.height=this._logo.height,this._logo.addChild(this._safeEmitter);var a=this.game.add.emitter(0,50,70);a.makeParticles("atlas2",["particle"]),a.setAlpha(1,0,1e3),a.setScale(.6,.1,.6,.1,1e3),a.setXSpeed(-50,50),a.setYSpeed(-50,50),a.gravity=0,a.start(!1,1e3,2),a.width=this._playFree.width-300,a.height=this._playFree.height-50,this._playFree.addChild(a)},d.prototype.tick=function(){this._timerInstall++,window.playTime=this._timerInstall},d.prototype.getGurrentElementPosition=function(a){return this._panel.getElementPosition(a)},d.prototype.update=function(){window.collectable&&this._panel.update(),this._field&&this._field.update(),window.particleOn},d.prototype.destroyTutorial=function(){var a=this;this._handTween.stop(),this._hand.destroy(),this._playFreeBtnOsprite.visible=!0,this.game.add.tween(this._charTutorialSprite).to({y:this._charTutorialSprite.height+100},750,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.addOnce(function(){a._tutorialContainer.destroy(!0)},this),this.game.add.tween(this._tutorialOver).to({alpha:0},750,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.addOnce(function(){a._tutorialOver.destroy(!0)},this)},d.prototype.render=function(){},d.prototype.repositionEmitter=function(){var b;b=a.Core.isLandscape?a.Core.centerX-20:a.Core.centerY-20,this._fruitFallEmitter.emitX=this.game.rnd.between(-b,b),this.game.time.events.add(window.fruitSpawRate,this.repositionEmitter.bind(this))},d.prototype.showWinScreen=function(){this._winscreenShowed||(window.sounds&&this.game.sound.play("5",.4),this._winscreenShowed=!0,this._playFree.visible=!1,this._playFree.inputEnabled=!1,this._playFreeBtnOsprite.removeChild(this._playFree),this._panelContainer=new a.OSprite(a.Core.centerX,a.Core.centerY).otherXY(a.Core.centerY,a.Core.centerX).end(),this.game.stage.addChild(this._panelContainer),this._backOverlay=this.game.add.graphics(0,0),this._panelContainer.addChild(this._backOverlay),this._backOverlay.beginFill(2432282,.8),this._backOverlay.drawRect(-1024,-1024,2048,2048),this._backOverlay.endFill(),window.particleOn&&(this._panelContainer.addChild(this._fruitFallEmitter),a.Core.isLandscape?this._fruitFallEmitter.emitY=-a.Core.centerY-100:this._fruitFallEmitter.emitY=-a.Core.centerX-100,this._fruitFallEmitter.start(!1,4600,window.fruitSpawRate),this.repositionEmitter()),this._panelSprite=this.game.make.sprite(0,0,"atlas2","final_popup"),this._panelSprite.anchor.set(.5),this._sunraySprite=this.game.make.sprite(0,0,"atlas2","lucksherry_sunray"),this._sunraySprite.scale.set(7),this._sunraySprite.anchor.set(.5),this._sunraySprite.alpha=.6,this._panelContainer.addChild(this._sunraySprite),this.game.add.tween(this._sunraySprite).to({angle:360},18500,Phaser.Easing.Linear.None,!0,0,-1),this._panelContainer.addChild(this._panelSprite),this._panelSprite.addChild(this._playFree),this._playFree.position.set(0,217),this._playFree.anchor.x=.5,this._playFree.scale.set(.85,.85),this._playFree.visible=!0,this._playFree.inputEnabled=!0,this._congrateText=this.game.add.bitmapText(0,45,"font2",window.tutorialText[1],50),this._congrateText.anchor.setTo(.5,.5),this._congrateText.align="center",this._congrateText.tint=7550465,this._panelSprite.addChild(this._congrateText),this._plotText=this.game.add.bitmapText(0,143,"font2",window.tutorialText[2],50),this._plotText.maxWidth=500,this._plotText.anchor.setTo(.5,.5),this._plotText.align="center",this._plotText.tint=7550465,this._panelSprite.addChild(this._plotText),this._panelContainer.alpha=0,this._panelSprite.scale.set(.1,.1),this.game.add.tween(this._panelSprite.scale).to({x:1,y:1},700,Phaser.Easing.Back.Out,!0),this.game.add.tween(this._panelContainer).to({alpha:1},700,Phaser.Easing.Sinusoidal.Out,!0))},d.prototype.onLandscape=function(){this._bg&&(this._borders[0].position.set(a.Core.width,a.Core.height),this._borders[1].position.set(0,0),this._borders[3].position.set(a.Core.width,0),this._borders[2].position.set(0,a.Core.height)),this._panel&&(this._panel.setLandscape(),window.particleOn&&(this._fruitFallEmitter.emitY=-a.Core.centerY-100))},d.prototype.onPortret=function(){this._bg&&(this._borders[0].position.set(a.Core.width,a.Core.height),this._borders[1].position.set(0,0),this._borders[3].position.set(a.Core.width,0),this._borders[2].position.set(0,a.Core.height)),this._panel&&(this._panel.setPortrait(),window.particleOn&&(this._fruitFallEmitter.emitY=-a.Core.centerX-100))},d}(a.OState);a.PlayState=c}(mygame||(mygame={}));var __extends=this&&this.__extends||function(){var a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])};return function(b,c){function d(){this.constructor=b}a(b,c),b.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d)}}(),mygame;!function(a){var b=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}return __extends(c,b),c.prototype.preload=function(){var a=this;this.preloadContainer=this.add.sprite(0,0,""),this.preloadContainer.anchor.set(.5,.5),this.preloadLogo=this.add.image(0,0,"logo"),this.preloadContainer.addChild(this.preloadLogo),this.preloadLogo.position.set(-this.preloadLogo.width/2,0),this.preloadLogo.y-=50,this.preloadBar=this.add.image(0,0,"preloaderBar"),this.preloadContainer.addChild(this.preloadBar),this.preloadBar.position.set(-this.preloadBar.width/2,0),this.preloadBar.y+=60,this.preloadBarBackgroundL=this.add.image(this.preloadBar.x,this.preloadBar.y,"scoreMetr"),this.preloadContainer.addChild(this.preloadBarBackgroundL),this.preloadBarBackgroundR=this.add.image(this.preloadBar.x+2*this.preloadBarBackgroundL.width,this.preloadBar.y,"scoreMetr"),this.preloadContainer.addChild(this.preloadBarBackgroundR),this.preloadBarBackgroundR.scale.set(-1,1),this.load.setPreloadSprite(this.preloadBar),this.ChangeSize();var b=window.baseURL;if(this.game.load.image("bg",b+"assets/"+window.bg),this.game.load.atlas("atlas2",b+"assets/atlas.png","assets/atlas.json"),this.game.load.image("button",b+"assets/"+window.button),this.game.load.bitmapFont("font",b+"assets/font_big_gradient.png",b+"assets/font_big_gradient.fnt"),this.game.load.bitmapFont("font2",b+"assets/font_small_white.png",b+"assets/font_small_white.fnt"),window.sounds){[1,3,5,12,14,15,16,17,19,21,22,23].forEach(function(c){return a.game.load.audio(c.toString(),b+"assets/sounds/"+c+".mp3")})}},c.prototype.shutdown=function(){this.preloadLogo.destroy(),this.preloadLogo=null,this.preloadBar.destroy(),this.preloadBar=null,this.preloadBarBackgroundL.destroy(),this.preloadBarBackgroundL=null,this.preloadBarBackgroundR.destroy(),this.preloadBarBackgroundR=null,this.preloadContainer.destroy(),this.preloadContainer=null},c.prototype.create=function(){a.Core.begin(this.game,!this.game.device.desktop),this.game.state.start("PlayState")},c.prototype.ChangeSize=function(){this.game.scale.setGameSize(window.innerWidth,window.innerHeight),window.innerHeight,window.innerWidth,this.preloadContainer.scale.set(.85*window.innerWidth/469,.85*window.innerWidth/469),this.preloadContainer.position.set(window.innerWidth/2,window.innerHeight/2-40)},c}(Phaser.State);a.Preloader=b}(mygame||(mygame={}));